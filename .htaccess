# Enable URL Rewriting
RewriteEngine On

# Set base directory
RewriteBase /

# Skip rewrite for existing files and directories
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Skip rewrite for frontend directory direct access
RewriteCond %{REQUEST_URI} ^/frontend/ [NC]
RewriteRule ^ - [L]

# Skip rewrite for api directory
RewriteCond %{REQUEST_URI} ^/api/ [NC]
RewriteRule ^ - [L]

# If accessing root, serve frontend/index.html
RewriteCond %{REQUEST_URI} ^/?$ [NC]
RewriteRule ^$ frontend/index.html [L]

# Remove .html extension from URLs and serve from frontend
RewriteCond %{REQUEST_URI} ^/([^/]+)/?$ [NC]
RewriteCond %{DOCUMENT_ROOT}/frontend/%1.html -f
RewriteRule ^([^/]+)/?$ frontend/$1.html [L]

# Redirect .html to clean URL
RewriteCond %{THE_REQUEST} \s/+([^.]+)\.html [NC]
RewriteRule ^ %1? [NC,L,R=301]

# Default page
DirectoryIndex frontend/index.html index.html index.php

# Security headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Prevent access to sensitive files
<FilesMatch "\.(sql|log|md|env)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protect config directory
<IfModule mod_rewrite.c>
    RewriteRule ^config/ - [F,L]
</IfModule>
